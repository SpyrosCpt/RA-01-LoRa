#include "Preprocessor.h"

//Font created from the Squix font converter found at https://oleddisplay.squix.ch/#/home
//Currently only fonts that take up 2 rows are supported (size 12 is a good size)
//Replace number of chars with 0x60 not 0xE0 if you only want ascii characters from 32 - 127
//current font is Dialog size 12
const UI8 CurrentFont[] = 
{
	0x0B, // Width: 11
	0x0F, // Height: 15
	0x20, // First Char: 32
	0x60, // Numbers of Chars: 96 

	// Jump Table:
	0xFF, 0xFF, 0x00, 0x04,  // 32:65535
	0x00, 0x00, 0x06, 0x05,  // 33:0
	0x00, 0x06, 0x07, 0x05,  // 34:6
	0x00, 0x0D, 0x11, 0x0A,  // 35:13
	0x00, 0x1E, 0x0E, 0x08,  // 36:30
	0x00, 0x2C, 0x14, 0x0B,  // 37:44
	0x00, 0x40, 0x12, 0x0A,  // 38:64
	0x00, 0x52, 0x03, 0x03,  // 39:82
	0x00, 0x55, 0x08, 0x05,  // 40:85
	0x00, 0x5D, 0x08, 0x05,  // 41:93
	0x00, 0x65, 0x0B, 0x06,  // 42:101
	0x00, 0x70, 0x10, 0x0A,  // 43:112
	0x00, 0x80, 0x04, 0x04,  // 44:128
	0x00, 0x84, 0x08, 0x04,  // 45:132
	0x00, 0x8C, 0x04, 0x04,  // 46:140
	0x00, 0x90, 0x07, 0x04,  // 47:144
	0x00, 0x97, 0x0E, 0x08,  // 48:151
	0x00, 0xA5, 0x0C, 0x08,  // 49:165
	0x00, 0xB1, 0x0E, 0x08,  // 50:177
	0x00, 0xBF, 0x0E, 0x08,  // 51:191
	0x00, 0xCD, 0x0E, 0x08,  // 52:205
	0x00, 0xDB, 0x0E, 0x08,  // 53:219
	0x00, 0xE9, 0x0E, 0x08,  // 54:233
	0x00, 0xF7, 0x0D, 0x08,  // 55:247
	0x01, 0x04, 0x0E, 0x08,  // 56:260
	0x01, 0x12, 0x0E, 0x08,  // 57:274
	0x01, 0x20, 0x04, 0x04,  // 58:288
	0x01, 0x24, 0x04, 0x04,  // 59:292
	0x01, 0x28, 0x12, 0x0A,  // 60:296
	0x01, 0x3A, 0x12, 0x0A,  // 61:314
	0x01, 0x4C, 0x12, 0x0A,  // 62:332
	0x01, 0x5E, 0x09, 0x06,  // 63:350
	0x01, 0x67, 0x18, 0x0D,  // 64:359
	0x01, 0x7F, 0x10, 0x08,  // 65:383
	0x01, 0x8F, 0x0E, 0x08,  // 66:399
	0x01, 0x9D, 0x0E, 0x08,  // 67:413
	0x01, 0xAB, 0x10, 0x09,  // 68:427
	0x01, 0xBB, 0x0E, 0x08,  // 69:443
	0x01, 0xC9, 0x0B, 0x07,  // 70:457
	0x01, 0xD4, 0x10, 0x09,  // 71:468
	0x01, 0xE4, 0x10, 0x09,  // 72:484
	0x01, 0xF4, 0x04, 0x03,  // 73:500
	0x01, 0xF8, 0x04, 0x03,  // 74:504
	0x01, 0xFC, 0x0E, 0x07,  // 75:508
	0x02, 0x0A, 0x0C, 0x06,  // 76:522
	0x02, 0x16, 0x12, 0x0A,  // 77:534
	0x02, 0x28, 0x10, 0x09,  // 78:552
	0x02, 0x38, 0x10, 0x09,  // 79:568
	0x02, 0x48, 0x0D, 0x08,  // 80:584
	0x02, 0x55, 0x10, 0x09,  // 81:597
	0x02, 0x65, 0x10, 0x08,  // 82:613
	0x02, 0x75, 0x0E, 0x08,  // 83:629
	0x02, 0x83, 0x0D, 0x07,  // 84:643
	0x02, 0x90, 0x10, 0x09,  // 85:656
	0x02, 0xA0, 0x0F, 0x08,  // 86:672
	0x02, 0xAF, 0x15, 0x0B,  // 87:687
	0x02, 0xC4, 0x0E, 0x07,  // 88:708
	0x02, 0xD2, 0x0D, 0x07,  // 89:722
	0x02, 0xDF, 0x10, 0x09,  // 90:735
	0x02, 0xEF, 0x08, 0x05,  // 91:751
	0x02, 0xF7, 0x08, 0x04,  // 92:759
	0x02, 0xFF, 0x06, 0x05,  // 93:767
	0x03, 0x05, 0x0F, 0x0A,  // 94:773
	0x03, 0x14, 0x0C, 0x06,  // 95:788
	0x03, 0x20, 0x07, 0x06,  // 96:800
	0x03, 0x27, 0x0E, 0x08,  // 97:807
	0x03, 0x35, 0x0E, 0x08,  // 98:821
	0x03, 0x43, 0x0C, 0x07,  // 99:835
	0x03, 0x4F, 0x0E, 0x08,  // 100:847
	0x03, 0x5D, 0x0E, 0x08,  // 101:861
	0x03, 0x6B, 0x07, 0x04,  // 102:875
	0x03, 0x72, 0x0E, 0x08,  // 103:882
	0x03, 0x80, 0x0E, 0x08,  // 104:896
	0x03, 0x8E, 0x04, 0x03,  // 105:910
	0x03, 0x92, 0x04, 0x03,  // 106:914
	0x03, 0x96, 0x0C, 0x07,  // 107:918
	0x03, 0xA2, 0x04, 0x03,  // 108:930
	0x03, 0xA6, 0x14, 0x0B,  // 109:934
	0x03, 0xBA, 0x0E, 0x08,  // 110:954
	0x03, 0xC8, 0x0E, 0x08,  // 111:968
	0x03, 0xD6, 0x0E, 0x08,  // 112:982
	0x03, 0xE4, 0x0E, 0x08,  // 113:996
	0x03, 0xF2, 0x09, 0x05,  // 114:1010
	0x03, 0xFB, 0x0C, 0x07,  // 115:1019
	0x04, 0x07, 0x08, 0x05,  // 116:1031
	0x04, 0x0F, 0x0E, 0x08,  // 117:1039
	0x04, 0x1D, 0x0B, 0x06,  // 118:1053
	0x04, 0x28, 0x11, 0x09,  // 119:1064
	0x04, 0x39, 0x0C, 0x06,  // 120:1081
	0x04, 0x45, 0x0B, 0x06,  // 121:1093
	0x04, 0x50, 0x0A, 0x05,  // 122:1104
	0x04, 0x5A, 0x0E, 0x08,  // 123:1114
	0x04, 0x68, 0x06, 0x04,  // 124:1128
	0x04, 0x6E, 0x0C, 0x08,  // 125:1134
	0x04, 0x7A, 0x11, 0x0A,  // 126:1146
	0x04, 0x8B, 0x0E, 0x07,  // 127:1163

	// Font Data:
	0x00,0x00,0x00,0x00,0xF8,0x0D,	// 33
	0x00,0x00,0x38,0x00,0x00,0x00,0x38,	// 34
	0x00,0x00,0x00,0x02,0x40,0x0A,0xC0,0x07,0x70,0x02,0x40,0x0E,0xE0,0x03,0x50,0x02,0x40,	// 35
	0x00,0x00,0x00,0x00,0xE0,0x04,0x90,0x08,0xF8,0x3F,0x10,0x09,0x20,0x07,	// 36
	0x70,0x00,0x88,0x00,0x88,0x08,0x70,0x06,0x80,0x01,0xC0,0x00,0x30,0x07,0x88,0x08,0x80,0x08,0x00,0x07,	// 37
	0x00,0x00,0x00,0x07,0xF0,0x0C,0x48,0x08,0x88,0x08,0x10,0x09,0x00,0x06,0x00,0x0A,0x80,0x09,	// 38
	0x00,0x00,0x38,	// 39
	0x00,0x00,0xE0,0x03,0x1C,0x1C,0x04,0x10,	// 40
	0x00,0x00,0x04,0x10,0x1C,0x1C,0xE0,0x03,	// 41
	0x00,0x00,0x90,0x00,0x60,0x00,0xF8,0x01,0x60,0x00,0x90,	// 42
	0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0xE0,0x0F,0x00,0x01,0x00,0x01,0x00,0x01,	// 43
	0x00,0x00,0x00,0x1C,	// 44
	0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,	// 45
	0x00,0x00,0x00,0x0C,	// 46
	0x00,0x18,0x00,0x07,0xE0,0x00,0x18,	// 47
	0x00,0x00,0xE0,0x03,0x18,0x0C,0x08,0x08,0x08,0x08,0x18,0x0C,0xE0,0x03,	// 48
	0x00,0x00,0x08,0x08,0x08,0x08,0xF8,0x0F,0x00,0x08,0x00,0x08,	// 49
	0x00,0x00,0x10,0x08,0x08,0x0C,0x08,0x0A,0x08,0x09,0x98,0x08,0x70,0x08,	// 50
	0x00,0x00,0x10,0x04,0x08,0x08,0x88,0x08,0x88,0x08,0x88,0x08,0x70,0x07,	// 51
	0x00,0x00,0x00,0x03,0xC0,0x02,0x20,0x02,0x18,0x02,0xF8,0x0F,0x00,0x02,	// 52
	0x00,0x00,0x78,0x04,0x48,0x08,0x48,0x08,0x48,0x08,0xC8,0x0C,0x80,0x07,	// 53
	0x00,0x00,0xE0,0x03,0x90,0x0C,0x48,0x08,0x48,0x08,0xC8,0x0C,0x90,0x07,	// 54
	0x00,0x00,0x08,0x00,0x08,0x08,0x08,0x06,0x88,0x01,0x68,0x00,0x18,	// 55
	0x00,0x00,0x70,0x07,0x88,0x08,0x88,0x08,0x88,0x08,0x88,0x08,0x70,0x07,	// 56
	0x00,0x00,0xF0,0x04,0x98,0x09,0x08,0x09,0x08,0x09,0x98,0x04,0xE0,0x03,	// 57
	0x00,0x00,0xC0,0x0C,	// 58
	0x00,0x00,0xC0,0x1C,	// 59
	0x00,0x00,0x80,0x01,0x80,0x01,0x80,0x01,0x40,0x02,0x40,0x02,0x40,0x02,0x60,0x06,0x20,0x04,	// 60
	0x00,0x00,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x02,	// 61
	0x00,0x00,0x20,0x04,0x60,0x06,0x40,0x02,0x40,0x02,0x40,0x02,0x80,0x01,0x80,0x01,0x80,0x01,	// 62
	0x10,0x00,0x08,0x00,0x88,0x0D,0x48,0x00,0x30,	// 63
	0x00,0x00,0xC0,0x07,0x20,0x08,0x10,0x10,0x88,0x23,0x48,0x24,0x48,0x24,0x48,0x24,0xC8,0x27,0x10,0x14,0x30,0x02,0xC0,0x01,	// 64
	0x00,0x08,0x00,0x07,0xE0,0x02,0x18,0x02,0x18,0x02,0xE0,0x02,0x00,0x07,0x00,0x08,	// 65
	0x00,0x00,0xF8,0x0F,0x88,0x08,0x88,0x08,0x88,0x08,0x88,0x08,0x70,0x07,	// 66
	0x00,0x00,0xE0,0x03,0x10,0x04,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x04,	// 67
	0x00,0x00,0xF8,0x0F,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x04,0xE0,0x03,	// 68
	0x00,0x00,0xF8,0x0F,0x88,0x08,0x88,0x08,0x88,0x08,0x88,0x08,0x88,0x08,	// 69
	0x00,0x00,0xF8,0x0F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,	// 70
	0x00,0x00,0xE0,0x03,0x10,0x04,0x08,0x08,0x08,0x08,0x88,0x08,0x88,0x08,0x90,0x07,	// 71
	0x00,0x00,0xF8,0x0F,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0xF8,0x0F,	// 72
	0x00,0x00,0xF8,0x0F,	// 73
	0x00,0x20,0xF8,0x1F,	// 74
	0x00,0x00,0xF8,0x0F,0x80,0x00,0x40,0x01,0x20,0x02,0x10,0x04,0x08,0x08,	// 75
	0x00,0x00,0xF8,0x0F,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,	// 76
	0x00,0x00,0xF8,0x0F,0x30,0x00,0xC0,0x00,0x00,0x03,0x00,0x03,0xC0,0x00,0x30,0x00,0xF8,0x0F,	// 77
	0x00,0x00,0xF8,0x0F,0x18,0x00,0x60,0x00,0x80,0x00,0x00,0x03,0x00,0x0C,0xF8,0x0F,	// 78
	0x00,0x00,0xE0,0x03,0x10,0x04,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x04,0xE0,0x03,	// 79
	0x00,0x00,0xF8,0x0F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,0x00,0x70,	// 80
	0x00,0x00,0xE0,0x03,0x10,0x04,0x08,0x08,0x08,0x08,0x08,0x18,0x10,0x24,0xE0,0x03,	// 81
	0x00,0x00,0xF8,0x0F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,0x01,0x70,0x06,0x00,0x08,	// 82
	0x00,0x00,0x70,0x04,0x88,0x08,0x88,0x08,0x88,0x08,0x88,0x08,0x10,0x07,	// 83
	0x08,0x00,0x08,0x00,0x08,0x00,0xF8,0x0F,0x08,0x00,0x08,0x00,0x08,	// 84
	0x00,0x00,0xF8,0x07,0x00,0x0C,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x0C,0xF8,0x07,	// 85
	0x18,0x00,0xE0,0x00,0x00,0x03,0x00,0x0C,0x00,0x0C,0x00,0x03,0xE0,0x00,0x18,	// 86
	0x08,0x00,0x70,0x00,0x80,0x03,0x00,0x0C,0xC0,0x03,0x38,0x00,0xC0,0x03,0x00,0x0C,0x80,0x03,0x70,0x00,0x08,	// 87
	0x08,0x08,0x18,0x04,0x60,0x03,0x80,0x00,0x60,0x03,0x18,0x04,0x08,0x08,	// 88
	0x08,0x00,0x30,0x00,0xC0,0x00,0x00,0x0F,0xC0,0x00,0x30,0x00,0x08,	// 89
	0x00,0x00,0x08,0x0C,0x08,0x0A,0x08,0x09,0x88,0x08,0x48,0x08,0x28,0x08,0x18,0x08,	// 90
	0x00,0x00,0x00,0x00,0xF8,0x3F,0x08,0x20,	// 91
	0x18,0x00,0xE0,0x00,0x00,0x07,0x00,0x18,	// 92
	0x00,0x00,0x08,0x20,0xF8,0x3F,	// 93
	0x00,0x00,0x00,0x00,0x20,0x00,0x10,0x00,0x08,0x00,0x08,0x00,0x10,0x00,0x20,	// 94
	0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,	// 95
	0x00,0x00,0x00,0x00,0x04,0x00,0x08,	// 96
	0x00,0x00,0x40,0x06,0x20,0x09,0x20,0x09,0x20,0x09,0x20,0x05,0xC0,0x0F,	// 97
	0x00,0x00,0xFC,0x0F,0x60,0x0C,0x20,0x08,0x20,0x08,0x60,0x0C,0xC0,0x07,	// 98
	0x00,0x00,0xC0,0x07,0x60,0x0C,0x20,0x08,0x20,0x08,0x40,0x04,	// 99
	0x00,0x00,0xC0,0x07,0x60,0x0C,0x20,0x08,0x20,0x08,0x60,0x0C,0xFC,0x0F,	// 100
	0x00,0x00,0xC0,0x07,0x60,0x0D,0x20,0x09,0x20,0x09,0x60,0x09,0xC0,0x05,	// 101
	0x20,0x00,0xF8,0x0F,0x24,0x00,0x24,	// 102
	0x00,0x00,0xC0,0x07,0x60,0x2C,0x20,0x48,0x20,0x48,0x60,0x6C,0xE0,0x3F,	// 103
	0x00,0x00,0xFC,0x0F,0x40,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0xC0,0x0F,	// 104
	0x00,0x00,0xE8,0x0F,	// 105
	0x00,0x40,0xE8,0x7F,	// 106
	0x00,0x00,0xFC,0x0F,0x00,0x01,0x80,0x02,0x40,0x04,0x20,0x08,	// 107
	0x00,0x00,0xFC,0x0F,	// 108
	0x00,0x00,0xE0,0x0F,0x20,0x00,0x20,0x00,0x20,0x00,0xC0,0x0F,0x20,0x00,0x20,0x00,0x20,0x00,0xC0,0x0F,	// 109
	0x00,0x00,0xE0,0x0F,0x40,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0xC0,0x0F,	// 110
	0x00,0x00,0xC0,0x07,0x60,0x0C,0x20,0x08,0x20,0x08,0x60,0x0C,0xC0,0x07,	// 111
	0x00,0x00,0xE0,0x7F,0x60,0x0C,0x20,0x08,0x20,0x08,0x60,0x0C,0xC0,0x07,	// 112
	0x00,0x00,0xC0,0x07,0x60,0x0C,0x20,0x08,0x20,0x08,0x60,0x0C,0xE0,0x7F,	// 113
	0x00,0x00,0xE0,0x0F,0x40,0x00,0x20,0x00,0x20,	// 114
	0x00,0x00,0xC0,0x04,0x20,0x09,0x20,0x09,0x20,0x09,0x40,0x06,	// 115
	0x20,0x00,0xF8,0x0F,0x20,0x08,0x20,0x08,	// 116
	0x00,0x00,0xE0,0x07,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x04,0xE0,0x0F,	// 117
	0x60,0x00,0x80,0x03,0x00,0x0C,0x00,0x0C,0x80,0x03,0x60,	// 118
	0x60,0x00,0x80,0x03,0x00,0x0C,0x80,0x03,0x60,0x00,0x80,0x03,0x00,0x0C,0x80,0x03,0x60,	// 119
	0x20,0x08,0xC0,0x06,0x00,0x01,0x00,0x01,0xC0,0x06,0x20,0x08,	// 120
	0x60,0x40,0x80,0x41,0x00,0x26,0x00,0x1C,0x80,0x03,0x60,	// 121
	0x20,0x0C,0x20,0x0A,0x20,0x09,0xA0,0x08,0x60,0x08,	// 122
	0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0xF8,0x3E,0x08,0x20,0x08,0x20,	// 123
	0x00,0x00,0x00,0x00,0xF8,0x7F,	// 124
	0x00,0x00,0x08,0x20,0x08,0x20,0xF8,0x3E,0x00,0x01,0x00,0x01,	// 125
	0x00,0x00,0x00,0x01,0x80,0x00,0x80,0x00,0x80,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x80,	// 126
	0x00,0x00,0xF0,0x7F,0x10,0x40,0x10,0x40,0x10,0x40,0x10,0x40,0xF0,0x7F,	// 127
};

/**
	* @brief 	This function sets the coumn start and end address for the OLED
	* @param 	x: Starting column on the OLED
	* 			  y: End column on the OLED
	* @retval   None
	*/
void setColAddress(UI8 x, UI8 y)
{
  ssd1306_WriteCommand(LCD_SET_COL_ADDR); 									   // 0x21 COMMAND
  ssd1306_WriteCommand(x); 				 		 							   // Column start address
  ssd1306_WriteCommand(y);						     						   // Column end address
}

/**
	* @brief 	This function sets the Page start and end address for the OLED
	* @param 	x: Starting page on the OLED
	* 				y: End page on the OLED
	* @retval   None
	*/
void setPageAddress(UI8 x, UI8 y)
{
  ssd1306_WriteCommand(LCD_SET_PAGE_ADDR); 									   // 0x22 COMMAND
  ssd1306_WriteCommand(x); 													   // Start Page address
  ssd1306_WriteCommand(y);													   // End Page address 
}

/**
	* @brief 	This function Writes an SSD1306 specific command
	* @param 	byte: command to send 
	* @retval None
	*/
void ssd1306_WriteCommand(UI8 byte)
{
	UI8 i = 0;
	
	OLED_CS_CLR(); //CS Select OLED
	OLED_DC_CLR();//DC Reset
	for(i=0;i<100;i++) ;
	BB_WriteData(byte);//Send data
	for(i=0;i<100;i++) ;
	OLED_CS_SET(); //CS Unselect OLED
}

/**
	* @brief 	This function sends data to the SSD1306
	* @param 	arr: The array of data to send
	*					bytesToWrite: number of bytes to send
	* @retval   None
	*/
void ssd1306_WriteData1(UI8 arr[], UI16 bytesToWrite)//UI8 byte)
{
	UI16 i,j;
	
	OLED_CS_CLR(); //CS Select OLED
	OLED_DC_SET();//DC Reset

	for(i=0;i<100;i++) ;

	for(j=0; j < bytesToWrite; j++) BB_WriteData(arr[j]);

	for(i=0;i<100;i++) ;
	OLED_CS_SET(); //CS Unselect OLED
}

/**
	* @brief 	This function prepares the datat to be sent to the SSD1306
	* @param 	charArray: raw data to send (no font data yet)
	*					size: size of array
	* 				x: x position on OLED
	*					y: y position on OLED
	* @retval   None
	*/
void TransferBuffer(UI8 charArray[], UI8 size, UI8 x, UI8 y)
{
	UI16 i=0, j=0;  								                                                                                                                                            
	UI8 AllChars[128*2];												   	   //Array 1 transfered to OLED
	UI8 fontJumpArrOffset = 4;
	UI8 byteCount = 0;
	UI8 bytesToRead = 0;
	UI8 currentChar = 0;
	UI8 FontData[4] = {0x00,0x00,0x00,0x00};
	UI16 charStartPoint = 0;
	UI8 AllChars_pos = 0;
	UI8 FirstRow[128];
	UI8 SecondRow[128];
		
	for(i = 0; i<128;i++)
	{
		FirstRow[i] = 0x00;
		SecondRow[i] = 0x00;
	}
	for(i=0; i < sizeof(AllChars); i++) AllChars[i] = 0x00;
	
	//just grab the bytes and start shoving them into the array, 
	//rememeber to keep track of them so we know how many we have, stop when we reach 128
	for(i = 0; i < size; i++)
	{
		currentChar = charArray[i] - 32; //current char - 32 (first char is 32)
		if(currentChar > 96) currentChar = 0;
		for(j = 0; j < 4; j++) //read the font data of the current char
		{
			FontData[j] = CurrentFont[(currentChar * 4) + fontJumpArrOffset + j];
			
		}
		bytesToRead = FontData[2];  //how many bytes are in this char?
		
		//jump table is the following:
		//byte 0 shows the offset of each char (high byte)
		//byte 1 shows the offset of each char  (low byte)
		//byte 2 shows how many bytes are in the character
		//byte 3 shows the width of the char
		charStartPoint = (FontData[0]<<8) + FontData[1]; //calculate where we need to grab from in the array
		charStartPoint += (CurrentFont[3]*4); //there are x chars in the font and each has 4 bytes in jump table
		charStartPoint += 4; //there are 4 chars in the beginning (width height firstChar and numChars)
		
		if((AllChars_pos + (FontData[3])) < (128- x)) //will there be space? /2 because font takes up 2 lines
		{
			for(j=0; j<bytesToRead; j++) //read all the bytes in the arr
			{
				FirstRow[AllChars_pos] = CurrentFont[charStartPoint + j];
				if((j+1) < bytesToRead) SecondRow[AllChars_pos] = CurrentFont[charStartPoint + j + 1];
				else SecondRow[AllChars_pos] = 0x00; //so we dont grab a char we arent meant to
				j++;
				AllChars_pos++;
			}
			if((FontData[3]*2) > bytesToRead) 
			{
				for(j = 0; j < ((FontData[3] * 2) - bytesToRead); j++)
				{
					FirstRow[AllChars_pos] = 0x00;
					SecondRow[AllChars_pos] = 0x00;
					AllChars_pos++; //this is wrong maybe
				}
			}
			byteCount += FontData[3];
		}
		else break; 
		
		charStartPoint = 0;
	}

	j=0;
	for(i = x; i < 128; i++)
	{
		AllChars[i] = FirstRow[j];
		AllChars[128 + i] = SecondRow[j];
		j++;
	}
	setColAddress(0, 127);
	setPageAddress(y, 7);
	ssd1306_WriteData1(AllChars, sizeof(AllChars)); //send data to OLED
}

/**
	* @brief 	This function clears a row on the OLED
	* @param 	line: the line to be cleared
	* @retval None
	*/
void OLED_ClearLine(UI8 line)
{
	UI16 i;
	UI8 BlankLine[256]; //we are actuall clearing two rows (so 128 * 2)
	
	for(i = 0; i < 256; i++) BlankLine[i] = 0x00;
	setColAddress(0, 127);
	setPageAddress(line, 7);
	ssd1306_WriteData1(BlankLine, sizeof(BlankLine));
}

/**
	* @brief 	This function toggles the OLED reset pin, resetting the OLED
	* @param 	None
	* @retval None
	*/
void OLED_Reset(void)
{
	OLED_RST_SET();
	delayus(1);
	OLED_RST_CLR();
	delayus(10);
	OLED_RST_SET();
}

/**
	* @brief 		This function initializes the OLED using recommended values
	* @param 		None
	* @retval   None
	*/
void OLED_init(void)	
{
	OLED_Reset();

    // Recommended initialization sequence
	
  ssd1306_WriteCommand(LCD_DISP_OFF);
  ssd1306_WriteCommand(LCD_SET_COL_LO);
	ssd1306_WriteCommand(LCD_SET_COL_HI);
	ssd1306_WriteCommand(LCD_SET_LINE);
	ssd1306_WriteCommand(LCD_SET_PAGE);
	ssd1306_WriteCommand(LCD_SET_CONTRAST);
	ssd1306_WriteCommand(0xFF);
	ssd1306_WriteCommand(LCD_SET_SEG_REMAP1);
	ssd1306_WriteCommand(LCD_DISP_NOR);
	ssd1306_WriteCommand(LCD_SET_COM);
	ssd1306_WriteCommand(LCD_MULTIPLEX);
	ssd1306_WriteCommand(0x3F);
	ssd1306_WriteCommand(LCD_SET_OFFSET);
	ssd1306_WriteCommand(0x00);
	ssd1306_WriteCommand(LCD_SET_RATIO_OSC);
	ssd1306_WriteCommand(0x80);
	ssd1306_WriteCommand(LCD_SET_CHARGE);
	ssd1306_WriteCommand(0xF1);
	ssd1306_WriteCommand(LCD_MEM_ADDRESSING);
	ssd1306_WriteCommand(0x00);
	ssd1306_WriteCommand(LCD_SET_PADS);
	ssd1306_WriteCommand(0x12);
	ssd1306_WriteCommand(LCD_SET_VCOM);
	ssd1306_WriteCommand(0x40);
	ssd1306_WriteCommand(LCD_CHARGE_PUMP);
	ssd1306_WriteCommand(0x14);
	ssd1306_WriteCommand(LCD_DISP_ON);
}

/**
	* @brief 	This function sets the OLED all pixes on or all off
	* @param 	col: colour, 1 = all  on, 0 = all off
	* @retval None
	*/
void OLED_Clr(UI8 col)
{
	UI16 i = 0;
	UI8 clrArr[1024];
	for(i = 0; i < 1024; i++)
	{
		if(col == 0) clrArr[i] = 0x00; 
		else clrArr[i] = 0xFF; 
	}
	ssd1306_WriteData1(clrArr, sizeof(clrArr));
}



